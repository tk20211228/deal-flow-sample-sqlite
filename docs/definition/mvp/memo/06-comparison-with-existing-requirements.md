# 既存要件定義書との比較・統合

## 目的

既存の要件定義書（`docs/requirements-definition.md`）と新しくヒアリングした内容を比較し、追加・更新が必要な部分を明確にする。

---

## 1. 一致している部分

### 1.1 ビジネスモデル

既存要件定義書の「1. ビジネスモデルの理解」セクションは、今回のヒアリング内容と完全に一致しています：

- 取引構造（A→B→C→D）
- 利益計算式：`利益 = 出口金額 - A金額 + 仲手等`
- 売上計上ルール

### 1.2 技術スタック

基本的に一致していますが、バージョンの違いがあります：

| 項目 | 既存要件定義書 | CLAUDE.md |
|------|---------------|-----------|
| Next.js | 14 | 15 |
| Tailwind CSS | 通常版 | v4 |

→ **対応**: Next.js 15、Tailwind CSS v4を採用

### 1.3 主要機能

以下の機能は既存要件定義書で既にカバーされています：

- 決済確定管理機能（優先度1）
- 進捗管理機能（優先度2）
- 調査関係管理機能（優先度3）
- BC契約管理機能（優先度4）
- 精算書管理機能（優先度5）
- 出口管理機能（優先度6）
- 業者配布メール機能（優先度7）
- 決済進捗管理機能（優先度8）
- 口座管理機能（優先度9）

---

## 2. 追加が必要な部分

### 2.1 フローチャートからの追加情報

#### 2.1.1 営業と事務員の役割分担の明確化

**既存**: 抽象的な記載
**追加**: 具体的な役割分担を明記

**営業の役割**:
1. 営業開始（言質取得：○○円ついたら売るという決断を取る）
2. 営業の報告と社内承認
3. 物件情報を事務員に提供（マイソク作成のため）
4. 書類取得の依頼（賃貸借契約書、重要事項調査報告書）
5. 売主への説明
6. 管理解約の申し込み

**事務員の役割**:
1. マイソク作成（営業に物件状況を確認）
2. マイソクを業者に送付
3. AB契約書作成（登記簿謄本の取得）
4. 契約書のスキャン・保存
5. 各種書類の取得依頼
6. 重要事項説明書・BC売買契約書の作成
7. 業者とのやり取り（送付・チェックバック・訂正）
8. 精算書の作成
9. 司法書士依頼
10. 決済後の書類・鍵の発送

#### 2.1.2 業者の役割

**追加**: 業者の役割を明記

1. マイソクを受け取り、買付証明を提出
2. 重説・BC契約書の内容チェック
3. 修正があればフィードバック
4. 精算書の内容チェック
5. 修正があればフィードバック
6. 決済後、賃貸借契約書原本と鍵を受領

#### 2.1.3 チェックバックループの明確化

**既存**: ステータス管理で記載
**追加**: 明確なループフローを追記

```
重説・BC契約書作成
    ↓
業者に送付
    ↓
業者が内容チェック ←┐
    ↓ No           │
再度訂正 ──────────┘
    ↓ Yes
必要書類と合わせて原本送付
```

```
精算書作成
    ↓
業者に送付
    ↓
業者が内容チェック ←┐
    ↓ No           │
再度訂正 ──────────┘
    ↓ Yes
担当営業に報告
```

### 2.2 営業から事務員への依頼フロー

**既存**: 「チャットワークへの通知連携（将来）」として記載
**追加**: MVP段階でシステム内に依頼機能を実装

#### 依頼の種類

1. **マイソク作成依頼**
   - 物件情報の提供
   - 作成期限の指定

2. **書類取得依頼**
   - 賃貸借契約書の取得依頼
   - 重要事項調査報告書の取得依頼
   - その他書類の取得依頼

3. **AB契約書作成依頼**
   - 契約情報の提供
   - 作成期限の指定

#### 依頼管理機能

- 依頼一覧表示
- 依頼ステータス管理（未対応/対応中/完了）
- 依頼日時の記録
- 完了日時の記録
- コメント機能

### 2.3 書類のスキャン・保存管理

**既存**: 「書類（Document）」として抽象的に記載
**追加**: 具体的な書類管理機能

#### AB契約関係の書類

- AB契約書（スキャン・保存）
- 委任状関係（スキャン・保存）
- 売主身分証（スキャン・保存）

#### BC契約関係の書類

- BC売買契約書（原本送付管理）
- 重要事項説明書（原本送付管理）

#### 決済関係の書類

- 精算書（BC用・AB用）
- ローン計算書
- 賃貸借契約書（原本）
- 鍵の管理

### 2.4 売主の印鑑証明の取得

**既存**: 記載なし
**追加**: 物件調査の一部として追加

「役所関係」に追加：
- 売主の印鑑証明書

### 2.5 建物管理への所有者変更月の連絡

**既存**: 記載なし
**追加**: 精算書作成時のタスクとして追加

精算書作成時に以下を実施：
- 賃貸管理の解約月確定
- **建物管理に所有者変更月を伝える**

---

## 3. 詳細化が必要な部分

### 3.1 業者ステータスの詳細化

**既存**: 7段階のステータス定義
**詳細化**: 各ステータスでの具体的なアクション

| ステータス | 事務員のアクション | 業者のアクション | 次のステータスへの条件 |
|-----------|------------------|----------------|---------------------|
| BC確定前 | 業者への配布・金額回収 | 金額回答 | 業者確定 |
| BC確定 CB待ち | 重説・BC契約書送付 | 内容チェック | チェック完了 |
| BC確定 契約待ち | 原本と必要書類送付 | 契約締結準備 | 契約日確定 |
| BC完了 決済日確定待ち | 決済日の調整 | 決済日の調整 | 決済日確定 |
| 決済日確定 精算書待ち | 精算書作成・送付 | 内容チェック | 精算書確定 |
| 精算書完了 決済待ち | 司法書士依頼・最終確認 | 決済準備 | 決済実行 |
| 決済完了 | 決済後処理 | 書類・鍵受領 | 完了 |

### 3.2 書類ステータスの詳細化

**既存**: 3段階のステータス定義（書類依頼待ち/書類取得中/全書類取得完了）
**詳細化**: 各書類の状態をより詳細に管理

| ステータス | 表示 | 説明 |
|-----------|------|------|
| 空欄 | - | 依頼前 |
| 依頼待ち | 🔴 | 営業からの依頼待ち（賃貸借契約書、重要事項調査報告書） |
| 依頼済み | 🟡 | 依頼済み、取得待ち |
| 取得完了 | ✅ | 書類取得完了 |
| 書類なし | ❌ | 該当書類なし |

### 3.3 賃貸管理解約の詳細化

**既存**: 基本的な管理機能の記載
**詳細化**: 解約フローの詳細化

#### 解約フロー

1. **決済日確定**
   - 決済日が決まった時点で解約月を確定

2. **解約申し込み**
   - 解約月の2〜3ヶ月前に申し込みが必要
   - 営業が申し込みを実施
   - システムで申し込み完了を記録

3. **解約月の管理**
   - 精算書作成時に解約月を使用
   - 家賃の精算計算

4. **解約完了**
   - 決済後、解約が完了
   - システムで解約完了を記録

#### アラート機能

- 解約申し込み期限の2週間前にアラート
- 解約申し込みが完了していない場合は毎日アラート
- 解約完了していない場合のアラート

---

## 4. 修正が必要な部分

### 4.1 技術スタックのバージョン

**修正前**: Next.js 14
**修正後**: Next.js 15

**修正前**: Tailwind CSS
**修正後**: Tailwind CSS v4

### 4.2 セクション番号の調整

既存要件定義書のセクション番号を維持しながら、新しい情報を追加する形で統合

---

## 5. 統合後の構造案

```
1. ビジネスモデルの理解（既存）
   1.1 事業概要（既存）
   1.2 取引構造と関係者（既存）
   1.3 利益構造（既存）
   1.4 業務フローの詳細（既存）
   1.5 売上計上ルール（既存）
   【追加】1.6 役割分担の詳細
      1.6.1 営業の役割
      1.6.2 事務員の役割
      1.6.3 業者の役割

2. プロジェクト概要（既存）

3. 機能要件（MVP）（既存）
   【追加】3.10 営業・事務員連携機能
      3.10.1 依頼管理機能
      3.10.2 依頼の種類
      3.10.3 依頼ステータス管理
   【追加】3.11 書類管理機能
      3.11.1 書類のアップロード・保存
      3.11.2 書類の分類管理
      3.11.3 書類の閲覧・ダウンロード

4. 非機能要件（既存）

5. システム構成（既存）

6. 画面構成（MVP）（既存）
   【追加】6.3 依頼管理画面
      - 依頼一覧
      - 依頼詳細
      - 依頼作成

7. 外部連携（既存）

8. 売上計上ルール（既存）

9. 開発フェーズ（MVP）（既存）
   【修正】Phase 1に「営業・事務員連携機能」を追加
   【修正】Phase 2に「書類管理機能」を追加

10. 成功指標（KPI）（既存）

11. リスクと対策（既存）

12. 将来の拡張性（既存）

13. 制約事項（既存）
```

---

## 6. 次のアクション

1. **既存要件定義書の更新**
   - 技術スタックのバージョン更新
   - 役割分担の詳細追加
   - 営業・事務員連携機能の追加
   - 書類管理機能の追加
   - 開発フェーズの修正

2. **新規ドキュメントの作成**
   - 詳細なワークフロー図の作成
   - 画面設計書の作成
   - データモデル詳細設計書の作成

3. **開発計画の見直し**
   - MVP範囲の再確認
   - 開発スケジュールの調整
   - 優先順位の再評価

---

## 7. MVP範囲の再確認

### 含めるべき機能（優先度高）

1. 決済確定管理機能
2. 進捗管理機能（業者ステータス・書類ステータス）
3. 調査関係管理機能
4. BC契約管理機能
5. 精算書管理機能
6. **営業・事務員連携機能**（依頼管理）
7. **書類管理機能**（基本的なアップロード・保存）

### 後回しにする機能（優先度中）

1. 出口管理機能（マイソク作成）
2. 業者配布メール機能
3. 口座管理機能の詳細（1億円上限警告は含める）
4. レポート・分析機能

### 将来の拡張（優先度低）

1. AI予測機能
2. 自動査定機能
3. 営業支援機能（スクリプト生成）
4. 外部システムとのリアルタイム連携
5. モバイルアプリ

---

## 8. 開発フェーズの修正案

### Phase 1（第1週）

- 環境構築・認証機能実装
- 決済確定管理機能（基本機能）
- **営業・事務員連携機能（依頼管理の基本）**

### Phase 2（第2週）

- 進捗管理機能（業者ステータス・書類ステータス）
- 調査関係管理機能
- **書類管理機能（アップロード・保存の基本）**

### Phase 3（第3週）

- BC契約管理機能
- 精算書管理機能
- 決済進捗管理機能

### Phase 4（第4週）

- 口座管理機能
- アラート・リマインダー機能
- テスト・デプロイ

### Phase 5（将来）

- 出口管理機能（マイソク作成）
- 業者配布メール機能
- レポート・分析機能
